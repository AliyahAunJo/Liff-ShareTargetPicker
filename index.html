<html>

<head>
  <link rel="stylesheet" href="flex2html.css" />
  <script type="text/javascript" src="flex2html.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <style>
    body {
      background-color: rgb(12, 131, 142);
    }
  </style>
</head>

<body>
  <div class="container text-center">
    <img id="pictureUrl" class="img-circle mb-2 mt-3" alt="Cinque Terre" width="50" height="50" />
    <p class="text-white mb-2" id="userId"></p>
    <center>
      <p class="text-white mb-2" id="displayName"></p>
    </center>
    <p class="text-white mb-2" id="statusMessage"></p>
    <p class="text-white mb-2" id="getDecodedIDToken"></p>
    <h2 class="mt-3 text-white">❤️ สร้าง Flex Message ❤️</h2>
    <button class="btn btn-outline-danger mb-3 text-white" onclick="goSimulator()">
      ไปที่ Flex Simulator
    </button>
    <br />
    <label id="label1" class="text-white mb-3" for="">Alt text</label>
    <input class="form-control mb-3" type="text" name="" id="alt" width="30px
    " />
    <label id="label2" class="text-white mb-3" for=""> Flex Message</label>


    <textarea class="form-control" id="flexjson" rows="20px" cols="30px" onchange="showFlex()"></textarea>
    <div class="chatbox mt-3 mb-3">
      <div id="flex1"></div>
    </div>
    <p class="mb-3 mt-3 text-white">กดปุ่มเพื่อส่ง Flex ไปหาเพื่อนของคุณ</p>

    <button class="btn btn-outline-info" type="button" onclick="myFunction()">
      ส่ง Flex ทันที
    </button>



    <p class="mt-5 text-white" id="demo"></p>
    <hr class="text-white" />
    <p class="text-white">❤️ พัฒนาโดย ครูอั๋นใจดี ❤️</p>
  </div>
  </div>

  <textarea id="flexjson" rows="20px" cols="55px" onchange="showFlex()"></textarea>
  <script>
    function showFlex() {
      var x = document.getElementById("flexjson").value;
      try {
        document.getElementById('flex1').innerHTML = "";
        x = JSON.parse(x)
        console.log(x)
        var flexdat = {}
        flexdat["type"] = "flex";
        flexdat["altText"] = "Flex Message";
        flexdat["contents"] = x;
        flex2html("flex1", flexdat);
      }
      catch (err) {
        console.log(err)
        document.getElementById('flex1').innerHTML = "";
      }
    }

    function runApp() {
      liff
        .getProfile()
        .then((profile) => {
          document.getElementById("pictureUrl").src = profile.pictureUrl; // %u0E41%u0E2A%u0E14%u0E07%u0E23%u0E39%u0E1B Profile %u0E17%u0E35%u0E48%u0E14%u0E36%u0E07%u0E21%u0E32
          document.getElementById("userId").innerHTML =
            "<b>UserId:</b><br/> " + profile.userId;
          document.getElementById("displayName").innerHTML =
            "<b>สวัสดี:</b><br/> " + profile.displayName; // %u0E41%u0E2A%u0E14%u0E07%u0E0A%u0E37%u0E48%u0E2D Line %u0E02%u0E2D%u0E07%u0E1C%u0E39%u0E49%u0E43%u0E0A%u0E49
          document.getElementById("statusMessage").innerHTML =
            "<b>StatusMessage:</b></br> " + profile.statusMessage; // %u0E41%u0E2A%u0E14%u0E07%u0E2A%u0E16%u0E32%u0E19%u0E30%u0E02%u0E2D%u0E07%u0E1C%u0E39%u0E49%u0E43%u0E0A%u0E49 Line
          //document.getElementById("getDecodedIDToken").innerHTML = '<b>Email:</b> ' + liff.getDecodedIDToken().email;
        })
        .catch((err) => console.error(err));
    }
    liff.init(
      { liffId: "2000563749-xo0QX4Ny" },
      () => {
        if (liff.isLoggedIn()) {
          runApp();
        } else {
          liff.login();
        }
      },
      (err) => console.error(err.code, error.message)
    );

    // logout
    const accessToken = liff.getAccessToken();
    if (accessToken) {
      fetch("https://api...", {
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${accessToken}`,
        },
        //...
      });
    }

    function myFunction() {
      var altText = document.getElementById("alt").value;
      var message = document.getElementById("flexjson").value;
      // document.getElementById("demo").innerHTML = message;

      liff.init({ liffId: "2000563749-xo0QX4Ny" });
      // liff.id equals to liffId
      liff.ready.then(() => {
        liff
          .shareTargetPicker([
            {
              type: "flex",
              altText: altText,
              contents: JSON.parse(message),
            },
          ])
          .then(() => {
            Swal.fire({
              position: "center",
              icon: "success",
              title: "ส่ง Flex เรียบร้อย !",
              showConfirmButton: false,
              timer: 1500,
            });
            document.getElementById("alt").value = "";
            document.getElementById("flexjson").value = "";

            console.log("message sent");
          })
          .catch((err) => {
            console.log("error", err);
          });
      });
    }
    //จบฟังก์ชั่น
    function goSimulator() {
      liff.openWindow({
        url: "https://developers.line.biz/flex-simulator/",
        external: true,
      });
    }


  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>
